<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêua Ng·ª±a Chuy√™n Nghi·ªáp v2</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .setup-panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        textarea { height: 80px; }
        button { background: #28a745; color: white; border: none; padding: 15px; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; width: 100%; transition: 0.3s; }
        button:hover { background: #218838; transform: scale(1.02); }

        #race-track { 
            background: #2e7d32; border: 5px solid #1b5e20; border-radius: 8px; 
            position: relative; display: none; padding: 10px 0;
            max-height: 80vh; overflow-y: auto;
        }
        .lane { 
            height: 70px; border-bottom: 1px dashed rgba(255,255,255,0.2); 
            position: relative; width: 100%; min-width: 1000px;
        }
        .horse-container { 
            position: absolute; left: 0; bottom: 5px; 
            display: flex; flex-direction: column; align-items: center; 
            will-change: transform; /* T·ªëi ∆∞u h√≥a hi·ªáu nƒÉng */
        }
        .horse-name { 
            background: rgba(0,0,0,0.7); color: white; padding: 2px 8px; 
            border-radius: 10px; font-size: 11px; white-space: nowrap; margin-bottom: 2px;
        }
        .horse-icon { font-size: 35px; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3)); }
        
        .finish-line { 
            position: absolute; right: 50px; top: 0; bottom: 0; width: 15px; 
            background: repeating-linear-gradient(0deg, #fff, #fff 10px, #000 10px, #000 20px); 
            border-left: 3px solid red; z-index: 10;
        }
        
        #timer-display { text-align: center; font-size: 48px; font-weight: bold; color: #d32f2f; margin: 10px 0; display: none; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        #result { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: white; padding: 40px; border-radius: 20px; 
            box-shadow: 0 0 100px rgba(0,0,0,0.5); text-align: center; 
            display: none; z-index: 1000; border: 4px solid #ffc107;
        }
    </style>
</head>
<body>

<div class="setup-panel" id="setup">
    <h2 style="text-align: center;">üèÅ C·∫§U H√åNH CU·ªòC ƒêUA</h2>
    <div class="input-group">
        <label>S·ªë l∆∞·ª£ng ng·ª±a (1 - 1000):</label>
        <input type="number" id="horseCount" value="5" min="1" max="1000">
    </div>
    <div class="input-group">
        <label>Danh s√°ch t√™n (D√°n t·ª´ Excel ho·∫∑c nh·∫≠p c√°ch nhau b·∫±ng d·∫•u ph·∫©y):</label>
        <textarea id="horseNames" placeholder="Ng·ª±a A, Ng·ª±a B, Ng·ª±a C..."></textarea>
    </div>
    <div class="input-group" style="display: flex; gap: 10px;">
        <div style="flex: 1;">
            <label>Ph√∫t:</label>
            <input type="number" id="minutes" value="0" min="0">
        </div>
        <div style="flex: 1;">
            <label>Gi√¢y:</label>
            <input type="number" id="seconds" value="15" min="5">
        </div>
    </div>
    <button onclick="initRace()">B·∫ÆT ƒê·∫¶U ƒêUA NGAY</button>
</div>

<div id="timer-display">00:00</div>
<div id="race-track"></div>

<div id="result">
    <div style="font-size: 50px;">üèÜ</div>
    <h1 id="winner-name" style="margin: 10px 0;"></h1>
    <p style="font-size: 18px; color: #666;">ƒê√£ v·ªÅ ƒë√≠ch xu·∫•t s·∫Øc!</p>
    <button onclick="location.reload()" style="background: #007bff;">QUAY L·∫†I C√ÄI ƒê·∫∂T</button>
</div>

<script>
    let animationId;
    let isRacing = false;

    function initRace() {
        const count = parseInt(document.getElementById('horseCount').value);
        const nameInput = document.getElementById('horseNames').value;
        const totalDuration = (parseInt(document.getElementById('minutes').value) * 60) + parseInt(document.getElementById('seconds').value);
        
        let names = nameInput.split(/[\n,]+/).map(n => n.trim()).filter(n => n !== "");
        
        const track = document.getElementById('race-track');
        track.innerHTML = '<div class="finish-line"></div>';
        track.style.display = 'block';
        document.getElementById('setup').style.display = 'none';
        document.getElementById('timer-display').style.display = 'block';

        const horses = [];
        for (let i = 0; i < count; i++) {
            const name = names[i] || `Ng·ª±a ${i + 1}`;
            const lane = document.createElement('div');
            lane.className = 'lane';
            
            const container = document.createElement('div');
            container.className = 'horse-container';
            container.innerHTML = `<span class="horse-name">${name}</span><span class="horse-icon">üêé</span>`;
            
            lane.appendChild(container);
            track.appendChild(lane);
            
            horses.push({
                el: container,
                name: name,
                x: 0,
                velocity: 0,
                baseSpeed: 0.05 + Math.random() * 0.05, // T·ªëc ƒë·ªô n·ªÅn kh√°c nhau
                burstChance: 0.01 + Math.random() * 0.02 // T·ª∑ l·ªá b·ª©t t·ªëc ng·∫´u nhi√™n
            });
        }

        startSmoothRace(horses, totalDuration);
    }

    function startSmoothRace(horses, duration) {
        const startTime = performance.now();
        const endTime = startTime + (duration * 1000);
        const finishX = 90; // V·ªã tr√≠ v·∫°ch ƒë√≠ch (%)

        function update() {
            const now = performance.now();
            const elapsed = (now - startTime) / 1000;
            const remaining = Math.max(0, (endTime - now) / 1000);

            // C·∫≠p nh·∫≠t ƒë·ªìng h·ªì
            const m = Math.floor(remaining / 60);
            const s = Math.floor(remaining % 60);
            document.getElementById('timer-display').innerText = 
                `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;

            let winner = null;

            horses.forEach(h => {
                // Logic di chuy·ªÉn m∆∞·ª£t m√†
                // 1. T·ªëc ƒë·ªô c∆° b·∫£n theo th·ªùi gian
                let acceleration = h.baseSpeed;

                // 2. B·ª©t t·ªëc ng·∫´u nhi√™n
                if (Math.random() < h.burstChance) {
                    h.velocity += 0.5; // C√∫ h√≠ch t·ªëc ƒë·ªô
                }

                // 3. ƒê·∫£m b·∫£o ng·ª±a ti·∫øn d·∫ßn v·ªÅ ƒë√≠ch theo th·ªùi gian quy ƒë·ªãnh
                const timeProgress = elapsed / duration;
                const targetX = timeProgress * finishX;
                
                // ƒêi·ªÅu ch·ªânh v·∫≠n t·ªëc ƒë·ªÉ b√°m s√°t ti·∫øn ƒë·ªô cu·ªôc ƒëua nh∆∞ng v·∫´n c√≥ s·ª± tr·ªìi s·ª•t
                h.velocity += (targetX - h.x) * 0.01;
                h.velocity *= 0.95; // L·ª±c ma s√°t ƒë·ªÉ t·ªëc ƒë·ªô kh√¥ng tƒÉng v√¥ h·∫°n
                
                h.x += Math.max(0.01, h.velocity); // ƒê·∫£m b·∫£o lu√¥n ti·∫øn v·ªÅ ph√≠a tr∆∞·ªõc

                // C·∫≠p nh·∫≠t v·ªã tr√≠ hi·ªÉn th·ªã
                h.el.style.transform = `translateX(${h.x}vw)`; // D√πng vw ƒë·ªÉ m∆∞·ª£t h∆°n tr√™n m·ªçi m√†n h√¨nh

                if (h.x >= 92) {
                    h.x = 92;
                    if (!winner) winner = h;
                }
            });

            if (now < endTime && !winner) {
                animationId = requestAnimationFrame(update);
            } else {
                // K·∫øt th√∫c cu·ªôc ƒëua
                const finalWinner = horses.reduce((prev, curr) => (prev.x > curr.x) ? prev : curr);
                showWinner(finalWinner.name);
            }
        }

        animationId = requestAnimationFrame(update);
    }

    function showWinner(name) {
        document.getElementById('winner-name').innerText = name;
        document.getElementById('result').style.display = 'block';
        document.getElementById('timer-display').style.display = 'none';
    }
</script>

</body>
</html>
