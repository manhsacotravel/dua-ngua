<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng ƒêua Ng·ª±a Chuy√™n Nghi·ªáp</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .setup-panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        textarea { height: 100px; resize: vertical; }
        button { background: #28a745; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; }
        button:hover { background: #218838; }

        #race-track { background: #2e7d32; border: 5px solid #1b5e20; border-radius: 8px; position: relative; overflow-x: hidden; display: none; padding: 10px 0; }
        .lane { height: 60px; border-bottom: 1px dashed rgba(255,255,255,0.3); position: relative; display: flex; align-items: center; }
        .horse-container { position: absolute; left: 0; display: flex; flex-direction: column; align-items: center; transition: left 0.1s linear; }
        .horse-name { background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; white-space: nowrap; margin-bottom: 2px; }
        .horse-icon { font-size: 30px; }
        .finish-line { position: absolute; right: 0; top: 0; bottom: 0; width: 10px; background: repeating-linear-gradient(45deg, #fff, #fff 10px, #000 10px, #000 20px); border-left: 2px solid red; }
        
        #timer-display { text-align: center; font-size: 40px; font-weight: bold; color: #d32f2f; margin: 10px 0; display: none; }
        #result { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 0 50px rgba(0,0,0,0.5); text-align: center; display: none; z-index: 100; }
    </style>
</head>
<body>

<div class="setup-panel" id="setup">
    <h2>C·∫•u H√¨nh Cu·ªôc ƒêua</h2>
    <div class="input-group">
        <label>S·ªë l∆∞·ª£ng ng·ª±a (T·ªëi ƒëa 1000):</label>
        <input type="number" id="horseCount" value="10" min="1" max="1000">
    </div>
    <div class="input-group">
        <label>Danh s√°ch t√™n ng·ª±a (C√°ch nhau b·ªüi d·∫•u ph·∫©y ho·∫∑c xu·ªëng d√≤ng):</label>
        <textarea id="horseNames" placeholder="V√≠ d·ª•: Chi·∫øn M√£, X√≠ch Th·ªë, ƒê·∫°i B√†ng..."></textarea>
    </div>
    <div class="input-group" style="display: flex; gap: 10px;">
        <div style="flex: 1;">
            <label>Ph√∫t:</label>
            <input type="number" id="minutes" value="0" min="0">
        </div>
        <div style="flex: 1;">
            <label>Gi√¢y:</label>
            <input type="number" id="seconds" value="10" min="5">
        </div>
    </div>
    <button onclick="initRace()">KH·ªûI T·∫†O & B·∫ÆT ƒê·∫¶U</button>
</div>

<div id="timer-display">00:00</div>
<div id="race-track"></div>

<div id="result">
    <h1 id="winner-name"></h1>
    <button onclick="location.reload()">ƒêUA L·∫†I</button>
</div>

<script>
    function initRace() {
        const count = parseInt(document.getElementById('horseCount').value);
        const nameInput = document.getElementById('horseNames').value;
        const totalSeconds = (parseInt(document.getElementById('minutes').value) * 60) + parseInt(document.getElementById('seconds').value);
        
        // X·ª≠ l√Ω danh s√°ch t√™n
        let names = nameInput.split(/[\n,]+/).map(n => n.trim()).filter(n => n !== "");
        
        const track = document.getElementById('race-track');
        track.innerHTML = '<div class="finish-line"></div>';
        track.style.display = 'block';
        document.getElementById('setup').style.display = 'none';
        document.getElementById('timer-display').style.display = 'block';

        const horses = [];

        // T·∫°o ng·ª±a
        for (let i = 0; i < count; i++) {
            const name = names[i] || `Ng·ª±a s·ªë ${i + 1}`;
            const lane = document.createElement('div');
            lane.className = 'lane';
            
            const container = document.createElement('div');
            container.className = 'horse-container';
            container.id = `horse-${i}`;
            
            container.innerHTML = `
                <span class="horse-name">${name}</span>
                <span class="horse-icon">üêé</span>
            `;
            
            lane.appendChild(container);
            track.appendChild(lane);
            
            horses.push({
                element: container,
                pos: 0,
                name: name,
                finished: false
            });
        }

        startRace(horses, totalSeconds);
    }

    function startRace(horses, duration) {
        const startTime = Date.now();
        const endTime = startTime + (duration * 1000);
        const timerDisplay = document.getElementById('timer-display');
        
        const interval = setInterval(() => {
            const now = Date.now();
            const remaining = Math.max(0, endTime - now);
            
            // C·∫≠p nh·∫≠t ƒë·ªìng h·ªì
            const m = Math.floor(remaining / 60000);
            const s = Math.floor((remaining % 60000) / 1000);
            timerDisplay.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;

            // Logic di chuy·ªÉn
            let leader = null;
            let maxPos = -1;

            horses.forEach(h => {
                if (!h.finished) {
                    // T·ªëc ƒë·ªô ƒë∆∞·ª£c t√≠nh to√°n d·ª±a tr√™n th·ªùi gian c√≤n l·∫°i ƒë·ªÉ ƒë·∫£m b·∫£o v·ªÅ ƒë√≠ch ƒë√∫ng l√∫c
                    const progress = (now - startTime) / (duration * 1000);
                    const randomBoost = Math.random() * 2;
                    h.pos = (progress * 90) + (randomBoost * (progress * 10)); 
                    
                    if (h.pos >= 92) h.pos = 92;
                    h.element.style.left = h.pos + "%";

                    if (h.pos > maxPos) {
                        maxPos = h.pos;
                        leader = h;
                    }
                }
            });

            // Khi h·∫øt th·ªùi gian
            if (remaining <= 0) {
                clearInterval(interval);
                // T√¨m con ng·ª±a c√≥ v·ªã tr√≠ xa nh·∫•t l√†m ng∆∞·ªùi th·∫Øng
                const winner = horses.reduce((prev, current) => (prev.pos > current.pos) ? prev : current);
                showWinner(winner.name);
            }
        }, 50);
    }

    function showWinner(name) {
        document.getElementById('winner-name').innerText = "üèÜ CHI·∫æN TH·∫ÆNG: " + name;
        document.getElementById('result').style.display = 'block';
    }
</script>

</body>
</html>
